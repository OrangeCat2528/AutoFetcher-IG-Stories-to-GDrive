I"a<p style="font-size:1.1rem;">A Google App Script for deploying a web application that automatically fetches the latest available IG Stories of a target Instagram user to your Google Drive.</p>

<p><strong>AN IMPORTANT UPDATE ON 2020-06-02 T16:00:00 +08:00</strong></p>

<p style="color:red;">The version Build 2020.05.14 failed on 2020-06-02 due to the suspension of the download source, storydownloader.net. The data of IG stories has been changed to fetch from the official site in the new version Build 2020.06.02.</p>

<p><strong>LAST UPDATE ON 2020-06-05 T11:50:00 +08:00</strong></p>

<p style="color:green;">The version Build 2020.05.14 works again as storydownloader.net resumed their service on 2020-06-05.</p>

<h2 id="how-to-use">How to Use</h2>

<ol>
  <li>
    <p>Create a new App Script project in your Google account, and open the project in the App Script Editor.</p>
  </li>
  <li>
    <p>Copy the scripts under the <code class="language-plaintext highlighter-rouge">gascript</code> folder to your App Script Editor.</p>
  </li>
  <li>
    <p>Open <code class="language-plaintext highlighter-rouge">code.js</code> and replace the following variables with your own values, and save the file.</p>
  </li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// User-defined Variables</span>
<span class="kd">var</span> <span class="nx">g_username</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">your username for this app</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">g_password</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">your password for this app</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">gdrive_id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">your google drive folder id for storing the downloaded files</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">lastlog_id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;your google doc ID for storing last tracking log&gt;</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">historylog_id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;your google doc ID for storing history log&gt;</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">crashReportEmail</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;your email for receiving crash report&gt;</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// New variables in Build 2020.06.02</span>
<span class="kd">var</span> <span class="nx">fetchContentLog_id</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;your google doc ID for storing fetched Instgram JSON Data</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">query_hash</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;your IG query_hash for story look up&gt;</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">COOKIE</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">IG Cookie in your web browser</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<ol>
  <li>
    <p>Deploy the updated App Script project as a web application, and authorize the app to read and write files in your Google Drive.</p>
  </li>
  <li>
    <p>Copy the URL of the deployed web application, like <code class="language-plaintext highlighter-rouge">https://script.google.com/&lt;your-app-path&gt;/exec?</code></p>
  </li>
</ol>

<p>Now you can test the application by passing a url like this, <code class="language-plaintext highlighter-rouge">https://script.google.com/&lt;your-app-path&gt;/exec?usr=&lt;app_username&gt;&amp;pwd=&lt;app_password&gt;&amp;target={"target":{"name":"nasa","id":"528817151"}}</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ig_user_id</code> is necessary to query the data of the target Instagram user from the official web API. You can obtain the ID with the username by using <a href="https://codeofaninja.com/tools/find-instagram-user-id">the ID finder powered by The Code of a Ninja</a>. The application will track and download the photos and videos to your Google Drive folder, if it finds any new IG stories from the target Instagram account.</p>

<h2 id="configure-an-auto-run">Configure an Auto-Run</h2>

<ol>
  <li>
    <p>At the end of the file <code class="language-plaintext highlighter-rouge">code.js</code>, make a copy the function <code class="language-plaintext highlighter-rouge">try_get()</code> and give it a new unique function name. and replace the value of the <code class="language-plaintext highlighter-rouge">target</code> field to the Instagram account youâ€™re willing to fetch.</p>
  </li>
  <li>
    <p>Go to your Google Developer Hub, and create a new trigger for this project.</p>
  </li>
  <li>
    <p>In the Add Trigger Dialog, choose the function name that you previously copied. Also, select an appropriate time interval to call the function, as the example below.</p>
  </li>
</ol>

<p><img src="/docs/images/setup_a_google_app_script_timed_trigger.png" alt="Setup a Google App Script Timed Trigger" /></p>

<h2 id="configure-crash-report">Configure Crash Report</h2>

<p>For Build 2020.06.05, a new function called <code class="language-plaintext highlighter-rouge">test_pipeline()</code> has been added to check if there are any stories shown from the Instagram accounts of BBCNews, NASA and Medium. Since they publish stories frequently, there should be always one or more items available. The function will send an email to your specified email address if it fetches no URLs to download.</p>

<ol>
  <li>
    <p>Enter your email to <code class="language-plaintext highlighter-rouge">historylog_id</code> in line 7.</p>
  </li>
  <li>
    <p>Go to your Google Developer Hub, and create a new trigger for this project.</p>
  </li>
  <li>
    <p>In the Add Trigger Dialog, choose <strong>test_pipeline</strong> and select Daily timer.</p>
  </li>
</ol>

<h2 id="license">License</h2>

<p>GNU Affero General Public License v3.0</p>
:ET